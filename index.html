<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CYOA Search</title>
    <script src="./index.js"></script>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/concrete.css/3.0.0/concrete.min.css">

</head>

<body>
    <main>
        <h4 style="margin-top: 0;">CYOA Search</h1>

            <p>A simple Choose your own adventure (the interesting choices kinda, rather then the print book kind)
                mostly pulled from
                <a target="_blank" rel="noopener" href="https://www.reddit.com/r/makeyourchoice">r/makeyourchoice</a>
                data is being built via <a target="_blank" rel="noopener"
                    href="https://docs.google.com/spreadsheets/d/1_uUxjdztolJlJrm0Smv3gJAaYLBQxLKVklZsIOb7N_g/edit?usp=sharing">google
                    sheets</a>
            </p>

            <div class="flex-centered" style="margin-bottom: 0.5rem;">
                <input id="searchbox"></input>
                <button class="" onclick="onSearch()" id="searchtrigger">Search</button>
                <button class="" onclick="clearSearch()" id="cleartrigger">Clear</button>
            </div>

            <div id="card-grid"></div>
    </main>

</body>

<script defer>
    const ElementInput = document.getElementById('searchbox')
    const ElementSearchBtn = document.getElementById('searchtrigger')
    const ElementGrid = document.getElementById('card-grid')

    let allCYOAS = [];

    async function run() {
        const response = await fetch("./data.json");
        const json = await response.json()
        allCYOAS = json.sort((a, b) => b.upvotes - a.upvotes);
        buildCYOAs(allCYOAS)
    }

    function CYOATemplate(cyoaItem) {
        const rootElement = document.createElement("div");
        rootElement.className = 'card-root';
        rootElement.id = cyoaItem.name.replaceAll(' ', '-');
        rootElement.innerHTML = `<div class="card">
                <div class="card-image">
                    <img src="${cyoaItem.imageLink}" />
                </div>
                <div class="card-text">
                    <h5>${cyoaItem.name}</h5>
                    <p id="description">${cyoaItem.description}</p>
                    <p id="creator">by ${cyoaItem.creator} @ <a target="_blank" href="${cyoaItem.home}" rel="noopener">wwwüè°</a>
                        </p>
                    <p>
                        <span>Interactive: ${cyoaItem.isInteractive ? '‚úîÔ∏è' : '‚ùå'}</span> <span>Jumpchain: ${cyoaItem.isJumpChain ? '‚úîÔ∏è' : '‚ùå'}</span>
                    </p>
                    <p id="themes">Themes: ${cyoaItem.themes.join(', ')}</p>
                    <p id="franchise">Franchise: ${cyoaItem.franchise.join(', ')}</p>
                    <p id="mechanics">Mechanics: ${cyoaItem.mechanics.join(', ')}</p>
                    <div id="play">
                        <a href="${cyoaItem.link}" target="_blank" rel="noopener"><button>Play</button></a>
                        ${!!cyoaItem.altLink ? '<a href="' + cyoaItem.altLink + '" target="_blank" rel="noopener"><button>Play Alt</button></a>' : ''}
                    </div>
                    <p id="info" style="margin-bottom: 0;">
                        <span>V: ${cyoaItem.version}</span> <span>upvotes: ${cyoaItem.upvotes}</span>
                    </p>
                </div>
            </div>`

        return rootElement;
    }

    function buildCYOAs(cyoaItems) {
        ElementGrid.replaceChildren(...cyoaItems.map(cyoaItem => CYOATemplate(cyoaItem)))
    }

    run()

    function onSearch() {
        ElementSearchBtn.setAttribute('disabled', true)

        const shownCYOAS = allCYOAS.filter(cyoa => `${cyoa.name}${cyoa.creator}${cyoa.themes.join()}${cyoa.franchise.join()}${cyoa.mechanics.join()}${cyoa.description}`.toLowerCase().includes(ElementInput.value.toLowerCase().trim()))
        buildCYOAs(shownCYOAS)

        ElementSearchBtn.removeAttribute('disabled')
    }

    function clearSearch() {
        buildCYOAs(allCYOAS)
    }

    ElementInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            onSearch()
        }
    });
</script>

</html>